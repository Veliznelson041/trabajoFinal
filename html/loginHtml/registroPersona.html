<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Persona</title>
  <link rel="stylesheet" href="/css/loginCss/register.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Leaflet CSS y JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* Estilos adicionales */
    .error {
      color: #e74c3c;
      font-size: 0.9rem;
      margin-top: 5px;
      display: block;
    }

    .error-field {
      border: 2px solid #e74c3c !important;
    }

    .success-field {
      border: 2px solid #2ecc71 !important;
    }

    .map-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin: 20px auto;
      max-width: 1000px;
    }

    #map {
      height: 400px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .map-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .map-controls button {
      padding: 8px 15px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
    }

    .map-controls button:hover {
      background: #2980b9;
    }

    .coordinates {
      margin-top: 15px;
      font-size: 0.9rem;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <header>
    <div class="header-container">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRt_eZYMvS26mdHNwVQw-zHWqDRdSz5XzAVHQ&s"
        alt="Logo de Suplementos Dynamite" class="logo" />
      <h1 id="title">Suplementos Dynamite</h1>
    </div>
    <p id="date-time"></p>
    <nav class="nav-bar">
      <ul>
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="/html/catalogo-Carrito-Producto-HTML/catalogo.html">Cat√°logo</a></li>
        <li><a href="../contactoHtml/contacto.html">Contacto</a></li>
        <li><a href="/html/loginHtml/login.html" class="btn-login"><i class="fas fa-user"></i> Iniciar Sesi√≥n</a></li>
      </ul>
    </nav>
  </header>

  <nav class="ruta">
    <a href="../index.html">Inicio</a> &gt;
    <a href="login.html">Iniciar Sesi√≥n</a> &gt;
    <a href="../loginHtml/register.html">Registrarse</a>
  </nav>

  <div class="container">
    <h1>Registro de Persona</h1>
    <form id="register-form" novalidate>
      <label for="nombres">Nombres:</label>
      <input type="text" id="nombre" name="nombre" required aria-describedby="help-nombres" />
      <small class="error" id="error-nombre"></small>
      <small id="help-nombres">Solo letras. No se permiten n√∫meros ni s√≠mbolos.</small>

      <label for="apellidos">Apellidos:</label>
      <input type="text" id="apellido" name="apellido" required aria-describedby="help-apellidos" />
      <small class="error" id="error-apellido"></small>
      <small id="help-apellidos">Solo letras. No se permiten n√∫meros ni s√≠mbolos.</small>

      <label for="dni">DNI:</label>
      <input type="text" id="dni" name="dni" required maxlength="8" minlength="7" aria-describedby="help-dni" />
      <small class="error" id="error-dni"></small>
      <small id="help-dni">Debe contener entre 7 y 8 d√≠gitos num√©ricos.</small>

      <label for="calle">Calle:</label>
      <input type="text" id="calle" name="calle" required aria-describedby="help-calle" />
      <small class="error" id="error-calle"></small>
      <small id="help-calle">Puede contener letras y n√∫meros.</small>

      <label for="provincia">Seleccione una provincia:</label>
      <select id="provincia" name="provincia" required>
        <option value="">--Seleccione--</option>
        <option value="Buenos Aires">Buenos Aires</option>
        <option value="Catamarca">Catamarca</option>
        <option value="Chaco">Chaco</option>
        <option value="Chubut">Chubut</option>
        <option value="C√≥rdoba">C√≥rdoba</option>
        <option value="Corrientes">Corrientes</option>
        <option value="Entre R√≠os">Entre R√≠os</option>
        <option value="Formosa">Formosa</option>
        <option value="Jujuy">Jujuy</option>
        <option value="La Pampa">La Pampa</option>
        <option value="La Rioja">La Rioja</option>
        <option value="Mendoza">Mendoza</option>
        <option value="Misiones">Misiones</option>
        <option value="Neuqu√©n">Neuqu√©n</option>
        <option value="R√≠o Negro">R√≠o Negro</option>
        <option value="Salta">Salta</option>
        <option value="San Juan">San Juan</option>
        <option value="San Luis">San Luis</option>
        <option value="Santa Cruz">Santa Cruz</option>
        <option value="Santa Fe">Santa Fe</option>
        <option value="Santiago del Estero">Santiago del Estero</option>
        <option value="Tierra del Fuego">Tierra del Fuego</option>
        <option value="Tucum√°n">Tucum√°n</option>
      </select>
      <small class="error" id="error-provincia"></small>

      <label for="departamento">Departamento:</label>
      <input type="text" id="departamento" name="departamento" required aria-describedby="help-departamento" />
      <small class="error" id="error-departamento"></small>
      <small id="help-departamento">Puede contener letras y n√∫meros.</small>

      <label for="localidad">Localidad:</label>
      <input type="text" id="localidad" name="localidad" required aria-describedby="help-localidad" />
      <small class="error" id="error-localidad"></small>
      <small id="help-localidad">Puede contener letras y n√∫meros.</small>

      <label for="genero">G√©nero:</label>
      <select id="genero" name="genero" required>
        <option value="">--Seleccione--</option>
        <option value="masculino">Masculino</option>
        <option value="femenino">Femenino</option>
        <option value="otro">Otro</option>
      </select>
      <small class="error" id="error-genero"></small>

      <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
      <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required />
      <small class="error" id="error-fecha"></small>

      <label for="imagen">Imagen de perfil:</label>
      <input type="file" id="imagen" name="imagen" accept=".jpg,.jpeg,.png" required aria-describedby="help-imagen" />
      <!-- se mostrar√° una vista previa de la imagen seleccionada -->
      <div id="image-preview-container" style="display: none; margin-top: 10px;">
        <img id="image-preview" src="" alt="Vista previa" style="max-width: 250px; max-height: 250px;">
        <button type="button" id="remove-image" style="display: block; margin-top: 5px;">
          Eliminar imagen
        </button>
      </div>
      <small class="error" id="error-imagen"></small>
      <small id="help-imagen">Formatos permitidos: JPG, JPEG o PNG.</small>

      <!-- Geolocalizaci√≥n autom√°tica -->
      <input type="hidden" name="latitud" id="latitud">
      <input type="hidden" name="longitud" id="longitud">
      <p id="geo-msg" style="color: green; font-size: 0.9em;"></p>

      
      <!-- Selector de c√°mara -->
      <label for="cameraSelect">Eleg√≠ la c√°mara:</label>
      <select id="cameraSelect"></select>

      <!-- Bot√≥n para activar c√°mara -->
      <button type="button" onclick="capturarFoto()">Tomar foto</button>

      <!-- Vista de c√°mara -->
      <video id="video" width="250" height="250" autoplay muted></video>
      <canvas id="canvas" width="250" height="250" style="display:none;"></canvas>
      <button type="button" id="borrarFoto" style="display:none;">üóëÔ∏è Borrar foto</button>

      <!-- Campo oculto donde guardo la imagen capturada -->
      <input type="hidden" name="imagenBase64" id="imagenBase64">

      <p><a href="../../docs/RegistroPersona.pdf" download>Proceso de registro de persona (PDF)</a></p>

      <button type="submit">Registrarse</button>
      <p><a href="../loginHtml/login.html">Volver al inicio de sesi√≥n</a></p>
    </form>
  </div>

  <!-- Mapa de ubicaci√≥n interactivo -->
  <div class="map-container">
    <h3>Tu ubicaci√≥n</h3>
    <p>Despl√°zate por el mapa y haz clic para marcar tu ubicaci√≥n exacta</p>
    <div id="map"></div>
    <div class="coordinates">
      <strong>Coordenadas actuales:</strong>
      <span id="coords-display">Lat: 0.0000, Lon: 0.0000</span>
    </div>
    <div class="map-controls">
      <button id="btn-center">Centrar en mi ubicaci√≥n</button>
      <button id="btn-marker">Marcar ubicaci√≥n</button>
      <button id="btn-reset">Restablecer ubicaci√≥n</button>
    </div>
  </div>

  <footer>
    <p>
      Direcci√≥n: Av. Pres. Arturo Illia 902, Catamarca, Argentina | Email:
      contacto@suplementosdynamite.com | Tel: (123) 456-7890
    </p>
    <div class="social-icons">
      <a href="https://wa.me/1234567890" target="_blank"><i class="fab fa-whatsapp"></i></a>
      <a href="https://www.instagram.com/suplementosdynamite" target="_blank"><i class="fab fa-instagram"></i></a>
    </div>
    <p>&copy; 2024 Suplementos Dynamite. Todos los derechos reservados.</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.querySelector(".btn-exportar");
      if (btn) {
        btn.addEventListener("click", () => {
          const personaId = localStorage.getItem("persona_id");
          if (personaId) {
            const campos = ["nombre", "apellido", "dni", "calle", "provincia", "departamento", "localidad", "genero", "fecha_nacimiento", "imagen"];
            const url = `http://localhost:3000/exportar/pdf?id=${personaId}&campos=${campos.join(",")}`;
            window.open(url, "_blank");
          } else {
            alert("No se encontr√≥ ID de persona. Volv√© a registrarte.");
          }
        });
      }
    });
  </script>




  <script>
    // Reloj en vivo
    const dateTimeElement = document.getElementById("date-time");
    const updateDateTime = () => {
      const now = new Date();
      dateTimeElement.innerText = now.toLocaleString();
    };
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Variables globales para el mapa
    let map;
    let userMarker;
    let clickMarker;
    let userLocation = { lat: -28.4696, lon: -65.7795 }; // Catamarca por defecto
    let coordsDisplay = document.getElementById('coords-display');

    // Vista previa de imagen
    const imagenInput = document.getElementById('imagen');
    const previewContainer = document.getElementById('image-preview-container');
    const imagePreview = document.getElementById('image-preview');
    const removeButton = document.getElementById('remove-image');

    imagenInput.addEventListener('change', function () {
      if (this.files && this.files[0]) {
        const file = this.files[0];
        const reader = new FileReader();

        reader.onload = function (e) {
          imagePreview.src = e.target.result;
          previewContainer.style.display = 'block';
        }

        reader.readAsDataURL(file);
      }
    });

    // Eliminar imagen seleccionada
    removeButton.addEventListener('click', function () {
      imagenInput.value = '';
      imagePreview.src = '';
      previewContainer.style.display = 'none';
    });

    // Validar archivo
    function validarArchivo(input) {
      if (!input.files || input.files.length === 0) return false;

      const archivo = input.files[0];
      const extensionesPermitidas = ["jpg", "jpeg", "png"];
      const extension = archivo.name.split('.').pop().toLowerCase();

      return extensionesPermitidas.includes(extension);
    }

    // Validaciones
    function soloTexto(valor) {
      return /^[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√±\s]+$/.test(valor.trim());
    }

    function soloNumeros(valor) {
      return /^\d+$/.test(valor);
    }

    function textoYNumeros(valor) {
      return /^[A-Za-z0-9\s]+$/.test(valor.trim());
    }

    // Funci√≥n para inicializar el mapa
    function initMap(lat, lon) {
      if (map) map.remove();

      // Crear el mapa
      map = L.map('map').setView([lat, lon], 15);

      // A√±adir capa de tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);

      // Crear marcador de usuario
      userMarker = L.marker([lat, lon]).addTo(map)
        .bindPopup('Tu ubicaci√≥n detectada')
        .openPopup();

      // Evento para agregar marcadores al hacer clic
      map.on('click', function (e) {
        // Eliminar marcador anterior si existe
        if (clickMarker) map.removeLayer(clickMarker);

        // Crear nuevo marcador
        clickMarker = L.marker(e.latlng).addTo(map)
          .bindPopup('Ubicaci√≥n seleccionada')
          .openPopup();

        // Actualizar coordenadas
        updateCoordinates(e.latlng.lat, e.latlng.lng);
      });

      // Actualizar coordenadas
      updateCoordinates(lat, lon);
    }

    // Actualizar coordenadas en la UI
    function updateCoordinates(lat, lon) {
      document.getElementById("latitud").value = lat;
      document.getElementById("longitud").value = lon;
      coordsDisplay.textContent = `Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}`;
    }

    // Centrar en la ubicaci√≥n del usuario
    function centerOnUser() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            map.setView([lat, lon], 15);
            userLocation = { lat, lon };

            // Mover marcador de usuario
            userMarker.setLatLng([lat, lon]);
            updateCoordinates(lat, lon);

            document.getElementById("geo-msg").textContent = "Ubicaci√≥n actualizada correctamente.";
          },
          function (error) {
            Swal.fire({
              icon: 'error',
              title: 'Error de geolocalizaci√≥n',
              text: 'No se pudo obtener tu ubicaci√≥n. Aseg√∫rate de tener los permisos activados.'
            });
          }
        );
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Tu navegador no soporta geolocalizaci√≥n.'
        });
      }
    }

    // Obtener ubicaci√≥n y mostrar en el mapa
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          userLocation = { lat, lon };

          // Asignar valores a los inputs ocultos
          document.getElementById("latitud").value = lat;
          document.getElementById("longitud").value = lon;

          // Mostrar mensaje
          document.getElementById("geo-msg").textContent = "Ubicaci√≥n detectada correctamente.";

          // Mostrar mapa
          initMap(lat, lon);
        },
        function (error) {
          // Usar ubicaci√≥n por defecto si falla
          document.getElementById("geo-msg").textContent = "No se pudo obtener tu ubicaci√≥n. Usando ubicaci√≥n por defecto (Catamarca).";
          initMap(userLocation.lat, userLocation.lon);
        }
      );
    } else {
      document.getElementById("geo-msg").textContent = "Tu navegador no soporta geolocalizaci√≥n. Usando ubicaci√≥n por defecto.";
      initMap(userLocation.lat, userLocation.lon);
    }

    // Eventos para los botones del mapa
    document.getElementById('btn-center').addEventListener('click', centerOnUser);

    document.getElementById('btn-marker').addEventListener('click', function () {
      Swal.fire({
        icon: 'info',
        title: 'Marcar ubicaci√≥n',
        text: 'Haz clic en cualquier lugar del mapa para marcar tu ubicaci√≥n exacta.'
      });
    });

    document.getElementById('btn-reset').addEventListener('click', function () {
      if (clickMarker) {
        map.removeLayer(clickMarker);
        clickMarker = null;
      }
      updateCoordinates(userLocation.lat, userLocation.lon);
      Swal.fire({
        icon: 'success',
        title: 'Ubicaci√≥n restablecida',
        text: 'Se ha restablecido a tu ubicaci√≥n original.'
      });
    });

    // Validaci√≥n de fecha de nacimiento
    document.getElementById("fecha_nacimiento").addEventListener("change", function () {
      const fecha = new Date(this.value);
      const hoy = new Date();
      const errorFecha = document.getElementById("error-fecha");
      errorFecha.textContent = "";

      if (fecha >= hoy) {
        errorFecha.textContent = "La fecha de nacimiento no puede ser futura.";
        this.classList.add("error-field");
        return;
      }

      // Verificar si es mayor de edad (18 a√±os)
      const edad = hoy.getFullYear() - fecha.getFullYear();
      const m = hoy.getMonth() - fecha.getMonth();
      const d = hoy.getDate() - fecha.getDate();
      let esMayor = edad > 18 || (edad === 18 && (m > 0 || (m === 0 && d >= 0)));

      if (!esMayor) {
        errorFecha.textContent = "Debes ser mayor de 18 a√±os para registrarte.";
        this.classList.add("error-field");
      } else {
        this.classList.remove("error-field");
        this.classList.add("success-field");
      }
    });

    // Validaci√≥n en tiempo real
    document.querySelectorAll('input, select').forEach(input => {
      input.addEventListener('blur', function () {
        const errorId = `error-${this.id}`;
        const errorElement = document.getElementById(errorId);
        if (!errorElement) return;

        errorElement.textContent = "";
        this.classList.remove("error-field", "success-field");

        // Validaciones espec√≠ficas
        if (this.id === 'nombre' || this.id === 'apellido') {
          if (!soloTexto(this.value) || this.value.trim().length < 3) {
            errorElement.textContent = this.id === 'nombre' ?
              "El nombre debe contener solo letras y al menos 3 caracteres." :
              "El apellido debe contener solo letras y al menos 3 caracteres.";
            this.classList.add("error-field");
          } else {
            this.classList.add("success-field");
          }
        }

        if (this.id === 'dni') {
          if (!soloNumeros(this.value) || this.value.length < 7 || this.value.length > 8) {
            errorElement.textContent = "El DNI debe tener entre 7 y 8 d√≠gitos num√©ricos.";
            this.classList.add("error-field");
          } else {
            this.classList.add("success-field");
          }
        }

        if (this.id === 'calle') {
          if (!textoYNumeros(this.value)) {
            errorElement.textContent = "La calle debe contener solo letras y/o n√∫meros.";
            this.classList.add("error-field");
          } else {
            this.classList.add("success-field");
          }
        }

        if (this.id === 'provincia' || this.id === 'genero') {
          if (!this.value) {
            errorElement.textContent = "Este campo es obligatorio.";
            this.classList.add("error-field");
          } else {
            this.classList.add("success-field");
          }
        }
      });
    });

    // Env√≠o del formulario con SweetAlert2
    document.getElementById('register-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      // Validar todos los campos
      let valid = true;
      const campos = [
        'nombre', 'apellido', 'dni', 'calle', 'provincia',
        'departamento', 'localidad', 'genero', 'fecha_nacimiento', 'imagen'
      ];

      campos.forEach(campo => {
        const element = document.getElementById(campo);
        const errorElement = document.getElementById(`error-${campo}`);

        if (!errorElement) return;

        errorElement.textContent = "";
        element.classList.remove("error-field");

        // Validaci√≥n b√°sica de campo requerido
        if (!element.value) {
          errorElement.textContent = "Este campo es obligatorio.";
          element.classList.add("error-field");
          valid = false;
        }
      });

      // Validaci√≥n adicional para imagen
      const imagen = document.getElementById('imagen');
      if (!validarArchivo(imagen)) {
        document.getElementById('error-imagen').textContent = "Debe subir una imagen JPG, JPEG o PNG v√°lida.";
        imagen.classList.add("error-field");
        valid = false;
      }

      // Si hay errores, mostrar alerta
      if (!valid) {
        Swal.fire({
          icon: 'error',
          title: 'Formulario incompleto',
          text: 'Por favor, complete todos los campos correctamente.',
          confirmButtonText: 'Entendido'
        });
        return;
      }

      // Enviar formulario
      const formData = new FormData(this);

      try {
        const resp = await fetch('http://localhost:3000/personas', {
          method: 'POST',
          body: formData
        });

        const resultado = await resp.json();

        console.log("Respuesta backend:", resultado);


        if (resp.ok) {
          alert("Registro exitoso");

          // Guardar el ID en localStorage
          localStorage.setItem("persona_id", resultado.id); 

          // Redirigir
          window.location.href = "/html/loginHtml/registroExitoso.html";
        }
        else {
          // Manejar error dni duplicado
          if (resp.status === 409 && resultado.campo === 'dni') {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: resultado.error,
              confirmButtonText: 'Entendido'
            });
            document.getElementById("dni").focus();
            document.getElementById("dni").select();
            return;
          }
          Swal.fire({
            icon: 'error',
            title: 'Error al registrar',
            text: resultado.error || 'Error desconocido',
            confirmButtonText: 'Entendido'
          });
        }
      } catch (error) {
        Swal.fire({
          icon: 'error',
          title: 'Error de conexi√≥n',
          text: 'No se pudo conectar con el servidor. Intente nuevamente.',
          confirmButtonText: 'Entendido'
        });
      }
    });

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const inputBase64 = document.getElementById('imagenBase64');
    const cameraSelect = document.getElementById('cameraSelect');
    const btnBorrarFoto = document.getElementById('borrarFoto');

    let currentStream = null;

    // Listar c√°maras disponibles
    async function listarCamaras() {
  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    const videoDevices = devices.filter(device => device.kind === 'videoinput');

    cameraSelect.innerHTML = '';
    videoDevices.forEach((device, index) => {
      const option = document.createElement('option');
      option.value = device.deviceId;
      option.text = device.label || `C√°mara ${index + 1}`;
      cameraSelect.appendChild(option);
    });

    if (videoDevices.length > 0) {
      video.style.display = "block";  // üëà Mostrar el video autom√°ticamente
      iniciarCamara(videoDevices[0].deviceId); // Usar la primera c√°mara por defecto
    } else {
      alert("No se detectaron c√°maras disponibles.");
    }
  } catch (error) {
    console.error("Error al acceder a las c√°maras:", error);
    alert("No se pudo acceder a la c√°mara. Verific√° los permisos del navegador.");
  }
}
    // Iniciar c√°mara seleccionada
    async function iniciarCamara(deviceId) {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }

      try {
        const constraints = {
          video: { deviceId: { exact: deviceId } }
        };

        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        currentStream = stream;
      } catch (err) {
        console.error('Error al acceder a la c√°mara:', err);
      }
    }

    // Escuchar cambio de c√°mara
    cameraSelect.addEventListener('change', () => {
      iniciarCamara(cameraSelect.value);
    });

    // Capturar imagen
    function capturarFoto() {
      const context = canvas.getContext('2d');

      // Mostrar canvas y mantener video visible para m√°s capturas
      canvas.style.display = 'block';

      // Dibujar la imagen actual del video
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Convertir a Base64 y guardar en input oculto
      const base64 = canvas.toDataURL('image/jpeg');
      inputBase64.value = base64;

      alert("üì∏ Foto tomada correctamente.");
    }

    // Inicializar al cargar la p√°gina
    function activarCamara() {
  const selectedDeviceId = cameraSelect.value;
  if (selectedDeviceId) {
    video.style.display = "block";
    iniciarCamara(selectedDeviceId);
  } else {
    alert("No se encontr√≥ ninguna c√°mara disponible");
  }
}

function capturarFoto () {
  const ctx = canvas.getContext('2d');

  // Mostrar el canvas y dibujar el fotograma actual del video
  canvas.style.display = 'block';
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // Guardar la imagen en Base64
  inputBase64.value = canvas.toDataURL('image/jpeg');

  // Mostrar bot√≥n borrar
  btnBorrarFoto.style.display = 'inline-block';
}
// Borrar la imagen capturada
btnBorrarFoto.addEventListener('click', () => {
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height); // limpiar canvas

  canvas.style.display = 'none';   // ocultar canvas
  inputBase64.value = '';          // limpiar campo oculto
  btnBorrarFoto.style.display = 'none'; // ocultar bot√≥n
});
window.addEventListener('load', listarCamaras);
  </script>
</body>

</html>