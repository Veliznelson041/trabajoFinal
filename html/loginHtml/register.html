
<!DOCTYPE html>
<html lang="es-AR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Usuario</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="../../css/loginCss/register.css" />
</head>

<body>
  <!-- Encabezado -->
  <header>
    <div class="header-container">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRt_eZYMvS26mdHNwVQw-zHWqDRdSz5XzAVHQ&s"
        alt="Logo de Suplementos Dynamite" class="logo" />
      <h1 id="title">Suplementos Dynamite</h1>
    </div>
    <br />
    <p id="date-time"></p>
    <nav class="nav-bar">
      <ul>
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="/html/catalogo-Carrito-Producto-HTML/catalogo.html">Catálogo</a></li>
        <li><a href="../contactoHtml/contacto.html">Contacto</a></li>
        <li><a href="/html/loginHtml/login.html" class="btn-login"><i class="fas fa-user"></i> Iniciar Sesión</a></li>
      </ul>
    </nav>
  </header>

  <!-- Ruta -->
  <nav class="ruta">
    <a href="../index.html">Inicio</a> &gt;
    <a href="login.html">Iniciar Sesión</a> &gt;
    <a href="../loginHtml/register.html">Registrarse</a>
  </nav>

  <!-- Contenedor principal -->
  <div class="container">
    <h2>Registro de Usuario</h2>
    <form id="register-form" novalidate enctype="multipart/form-data">
      <label for="reg-usuario">Nombre de usuario:</label>
      <input type="text" id="reg-usuario" required />

      <label for="reg-contraseña">Contraseña:</label>
      <input type="password" id="reg-contraseña" required />

      <label for="reg-repetir">Repetir contraseña:</label>
      <input type="password" id="reg-repetir" required />

      <label for="reg-email">Email:</label>
      <input type="email" id="reg-email" required />

      <label for="imagen">Imagen de perfil:</label>
      <input type="file" id="imagen" name="imagen" required />

      <div class="g-recaptcha" data-sitekey="6LeYuFQrAAAAAHakqw9SEOV0LS4FQIEp8ZnPA7Wn"></div>

      <button type="submit"><i class="fas fa-user-plus"></i> Registrarse</button>
      <p><a href="../loginHtml/login.html">Volver al inicio de sesión</a></p>
    </form>
  </div>

  <footer>
    <p>Dirección: Av. Pres. Arturo Illia 902, Catamarca, Argentina | Email:
      contacto@suplementosdynamite.com | Tel: (123) 456-7890</p>
    <div class="social-icons">
      <a href="https://wa.me/1234567890" target="_blank"><i class="fab fa-whatsapp"></i></a>
      <a href="https://www.instagram.com/suplementosdynamite" target="_blank"><i class="fab fa-instagram"></i></a>
    </div>
    <p>&copy; 2024 Suplementos Dynamite. Todos los derechos reservados.</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const dateTimeElement = document.getElementById("date-time");
      const updateDateTime = () => {
        const now = new Date();
        dateTimeElement.innerText = now.toLocaleString();
      };
      setInterval(updateDateTime, 1000);
      updateDateTime();

      const form = document.getElementById("register-form");
      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const usuario = document.getElementById("reg-usuario").value.trim();
        const clave = document.getElementById("reg-contraseña").value;
        const repetirClave = document.getElementById("reg-repetir").value;
        const email = document.getElementById("reg-email").value.trim();
        const imagen = document.getElementById("imagen");
        const recaptchaResponse = grecaptcha.getResponse();

        if (!recaptchaResponse) {
          Swal.fire("reCAPTCHA", "Por favor, verificá que no sos un robot.", "warning");
          return;
        }

        if (clave !== repetirClave) {
          Swal.fire("Error", "Las contraseñas no coinciden.", "error");
          return;
        }

        const persona_id = localStorage.getItem("persona_id") || 1;

        const formData = new FormData();
        formData.append("usuario", usuario);
        formData.append("clave", clave);
        formData.append("email", email);
        formData.append("persona_id", persona_id);
        formData.append("imagen_perfil", imagen.files[0]);

        try {
          const res = await fetch("http://localhost:3000/api/usuarios", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          if (res.ok) {
            Swal.fire("Registro exitoso", "Usuario creado correctamente.", "success")
              .then(() => {
                localStorage.removeItem("persona_id");
                window.location.href = "../loginHtml/login.html";
              });
          } else {
            Swal.fire("Error", data.error || "No se pudo registrar.", "error");
          }
        } catch (err) {
          console.error(err);
          Swal.fire("Error", "Error de servidor", "error");
        }
      });
    });
  </script>
</body>
</html>
